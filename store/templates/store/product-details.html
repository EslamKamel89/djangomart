<!--prettier-ignore-->
{% extends 'base.html' %}
{% block title %} {{ product.title }} {% endblock %}
{% block content %}

<div class="mt-16" x-data="productDetails()">
  <section class="max-w-6xl mx-auto px-4">
    <div class="grid lg:grid-cols-2 gap-10 items-start">
      <div
        class="bg-white border border-neutral rounded-2xl shadow-sm overflow-hidden"
      >
        <div class="w-full aspect-[4/3] bg-neutral-100 overflow-hidden">
          <img
            src="{{ product.image.url }}"
            alt="{{ product.title }}"
            class="w-full h-full object-cover"
          />
        </div>
      </div>

      <div class="space-y-5">
        <div>
          <h1 class="text-3xl md:text-4xl font-bold text-neutral-900">
            {{ product.title|capfirst }}
          </h1>
          <p class="mt-2 text-sm text-muted">{{ product.brand }}</p>
        </div>

        <div class="flex items-center gap-3">
          <span class="text-3xl font-semibold text-primary">
            ${{ product.price }}
          </span>
          <span
            class="text-sm px-3 py-1 bg-neutral text-neutral-700 rounded-md"
          >
            {{ product.category.name }}
          </span>
        </div>

        {% if product.description %}
        <p class="text-sm md:text-base text-neutral-700 leading-relaxed">
          {{ product.description }}
        </p>
        {% endif %}

        <div class="pt-4 flex flex-wrap items-center gap-5">
          <div class="flex items-center gap-3">
            <label
              for="quantity-input"
              class="text-sm font-medium text-neutral-700"
            >
              Quantity
            </label>
            <input
              id="quantity-input"
              type="number"
              value="1"
              x-model="count"
              min="1"
              class="w-20 px-3 py-2 border border-neutral rounded-md text-center text-sm focus:outline-none focus:ring-2 focus:ring-primary"
            />
          </div>

          <button
            @click="submit()"
            :disabled="loading"
            class="inline-flex items-center justify-center px-6 py-3 rounded-lg bg-primary text-white font-medium shadow hover:brightness-110 transition disabled:opacity-50"
          >
            Add to cart
          </button>

          <button
            class="inline-flex items-center justify-center px-5 py-3 rounded-lg border border-primary text-primary font-medium hover:bg-primary hover:text-white transition"
          >
            Add to wishlist
          </button>
        </div>

        <div class="pt-4 border-t border-neutral">
          <p class="text-xs text-muted">
            Ships within 2â€“4 business days. 30-day return policy.
          </p>
        </div>
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-4 mt-16">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-semibold text-neutral-900">Related products</h2>
      <a href="/" class="text-sm text-primary hover:underline"> View all </a>
    </div>

    <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {% for related_product in related_products %}
      <li
        class="bg-white border border-neutral rounded-lg shadow-sm hover:shadow-md transition overflow-hidden"
      >
        <a href="{{ related_product.get_absolute_url }}" class="block h-full">
          <div class="w-full aspect-[4/3] bg-neutral-100 overflow-hidden">
            <img
              src="{{ related_product.image.url }}"
              alt="{{ related_product.title }}"
              class="w-full h-full object-cover"
            />
          </div>

          <div class="p-4">
            <h3 class="text-sm font-semibold text-neutral-900 line-clamp-2">
              {{ related_product.title|capfirst }}
            </h3>

            <p class="text-xs text-muted mt-1">{{ related_product.brand }}</p>

            <div class="mt-3 flex items-center justify-between">
              <span class="text-primary font-semibold text-sm">
                ${{ related_product.price }}
              </span>
              <span
                class="text-[11px] px-2 py-1 bg-neutral text-neutral-700 rounded"
              >
                {{ related_product.category.name }}
              </span>
            </div>
          </div>
        </a>
      </li>
      {% empty %}
      <p class="text-sm text-muted col-span-full">No related products found.</p>
      {% endfor %}
    </ul>
  </section>
  {{ cart|json_script:"cart_data" }}
  <script>
    function productDetails() {
      cartData = JSON.parse(document.getElementById("cart_data").textContent);
      productId = "{{ product.id }}";
      return {
        count: "1",
        errors: {},
        loading: false,
        serverMessage: "",
        init() {
          if (cartData[productId]) {
            this.count = cartData[productId].count;
          }
        },
        async submit() {
          this.loading = true;
          this.errors = {};
          this.serverMessage = "";
          const res = await api.post("/cart/", {
            product_id: productId,
            count: this.count,
          });
          pr(res);
          this.serverMessage = res.data.message;
          try {
          } catch (error) {
          } finally {
            this.loading = false;
          }
        },
      };
    }
  </script>
</div>

{% endblock %}
